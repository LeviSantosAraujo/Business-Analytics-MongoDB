<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Analytics Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .field-card {
            transition: all 0.3s ease;
        }
        .field-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold">üìä Business Analytics Dashboard</h1>
                    <p class="text-blue-100 mt-1">Interactive MongoDB Data Analysis</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-blue-100">Dataset: 1.1M Business Records</div>
                    <div class="text-sm text-blue-100">Years: 2015-2025</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Panel - Configuration -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">üìã Report Configuration</h2>
                    
                    <!-- Report Type Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Report Type</label>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 field-card">
                                <input type="radio" name="report_type" value="summary" class="mr-3" checked>
                                <div>
                                    <div class="font-medium">üìà Summary Statistics</div>
                                    <div class="text-sm text-gray-600">Key metrics and aggregations</div>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 field-card">
                                <input type="radio" name="report_type" value="trend" class="mr-3">
                                <div>
                                    <div class="font-medium">üìä Trend Analysis</div>
                                    <div class="text-sm text-gray-600">Year-over-year trends</div>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 field-card">
                                <input type="radio" name="report_type" value="comparison" class="mr-3">
                                <div>
                                    <div class="font-medium">üèÜ Top/Bottom Performers</div>
                                    <div class="text-sm text-gray-600">Best and worst performers</div>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 field-card">
                                <input type="radio" name="report_type" value="distribution" class="mr-3">
                                <div>
                                    <div class="font-medium">üìâ Distribution Analysis</div>
                                    <div class="text-sm text-gray-600">Data distribution buckets</div>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 field-card">
                                <input type="radio" name="report_type" value="chat" class="mr-3">
                                <div>
                                    <div class="font-medium">üí¨ AI Insights</div>
                                    <div class="text-sm text-gray-600">Intelligent data analysis</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Field Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Fields</label>
                        <div id="field-selection" class="space-y-2 max-h-48 overflow-y-auto">
                            <!-- Fields will be populated here -->
                        </div>
                    </div>

                    <!-- Year Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Years</label>
                        <div id="year-selection" class="space-y-2 max-h-32 overflow-y-auto">
                            <!-- Years will be populated here -->
                        </div>
                    </div>

                    <!-- Chat Input (for AI Insights) -->
                    <div id="chat-input" class="mb-6 hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">What would you like to know?</label>
                        <textarea id="question" class="w-full p-3 border rounded-lg" rows="3" 
                                  placeholder="e.g., 'What are the revenue trends?' or 'Show me profit analysis...'"></textarea>
                    </div>

                    <!-- Generate Button -->
                    <button onclick="generateReport()" 
                            class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                        üöÄ Generate Report
                    </button>
                </div>

                <!-- Sample Data Preview -->
                <div class="bg-white rounded-lg shadow-md p-6 mt-6">
                    <h3 class="text-lg font-semibold mb-3 text-gray-800">üëÅÔ∏è Sample Data Preview</h3>
                    <div id="sample-preview" class="text-sm text-gray-600">
                        Loading sample data...
                    </div>
                </div>
            </div>

            <!-- Right Panel - Results -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-800">üìä Report Results</h2>
                        <div id="report-status" class="text-sm text-gray-600">
                            Ready to generate report
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div id="loading" class="hidden text-center py-12">
                        <div class="loading-spinner mx-auto mb-4"></div>
                        <p class="text-gray-600">Generating report...</p>
                    </div>

                    <!-- Results Container -->
                    <div id="results-container">
                        <div class="text-center py-12 text-gray-500">
                            <div class="text-6xl mb-4">üìä</div>
                            <p class="text-lg">Select report options and click "Generate Report" to begin analysis</p>
                            <p class="text-sm mt-2">Your 1.1M business records are ready for exploration</p>
                        </div>
                    </div>
                </div>

                <!-- Chart Container -->
                <div id="chart-container" class="bg-white rounded-lg shadow-md p-6 mt-6 hidden">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">üìà Visual Analytics</h3>
                    <canvas id="report-chart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm">üöÄ MongoDB Business Analytics Dashboard | Real-time Data Analysis</p>
            <p class="text-xs text-gray-400 mt-2">Powered by MongoDB Atlas & Flask</p>
        </div>
    </footer>

    <script>
        // Global variables
        let availableFields = [];
        let availableYears = [];
        let currentChart = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadFields();
            loadYears();
            loadSampleData();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Report type change handler
            document.querySelectorAll('input[name="report_type"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const chatInput = document.getElementById('chat-input');
                    if (this.value === 'chat') {
                        chatInput.classList.remove('hidden');
                    } else {
                        chatInput.classList.add('hidden');
                    }
                });
            });
        }

        // Load available fields
        async function loadFields() {
            try {
                const response = await fetch('/api/fields');
                const data = await response.json();
                
                if (data.success) {
                    availableFields = data.fields;
                    renderFieldSelection();
                } else {
                    console.error('Failed to load fields:', data.error);
                }
            } catch (error) {
                console.error('Error loading fields:', error);
            }
        }

        // Render field selection
        function renderFieldSelection() {
            const container = document.getElementById('field-selection');
            container.innerHTML = '';
            
            availableFields.forEach(field => {
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'flex items-center p-2 border rounded hover:bg-gray-50';
                fieldDiv.innerHTML = `
                    <input type="checkbox" id="field_${field.value}" value="${field.value}" class="mr-2">
                    <label for="field_${field.value}" class="flex-1 cursor-pointer">
                        <div class="font-medium text-sm">${field.label}</div>
                        <div class="text-xs text-gray-500">Type: ${field.type}</div>
                    </label>
                `;
                container.appendChild(fieldDiv);
            });
        }

        // Load available years
        async function loadYears() {
            try {
                const response = await fetch('/api/years');
                const data = await response.json();
                
                if (data.success) {
                    availableYears = data.years;
                    renderYearSelection();
                } else {
                    console.error('Failed to load years:', data.error);
                }
            } catch (error) {
                console.error('Error loading years:', error);
            }
        }

        // Render year selection
        function renderYearSelection() {
            const container = document.getElementById('year-selection');
            container.innerHTML = '';
            
            // Add "All Years" option
            const allYearsDiv = document.createElement('div');
            allYearsDiv.className = 'flex items-center p-2 border rounded hover:bg-gray-50';
            allYearsDiv.innerHTML = `
                <input type="checkbox" id="year_all" value="all" class="mr-2" checked>
                <label for="year_all" class="cursor-pointer font-medium text-sm">All Years</label>
            `;
            container.appendChild(allYearsDiv);
            
            // Add individual years
            availableYears.forEach(year => {
                const yearDiv = document.createElement('div');
                yearDiv.className = 'flex items-center p-2 border rounded hover:bg-gray-50';
                yearDiv.innerHTML = `
                    <input type="checkbox" id="year_${year}" value="${year}" class="mr-2">
                    <label for="year_${year}" class="cursor-pointer text-sm">Year ${year}</label>
                `;
                container.appendChild(yearDiv);
            });
            
            // Setup "All Years" toggle
            document.getElementById('year_all').addEventListener('change', function() {
                const yearCheckboxes = container.querySelectorAll('input[type="checkbox"]:not(#year_all)');
                yearCheckboxes.forEach(cb => cb.checked = this.checked);
            });
        }

        // Load sample data
        async function loadSampleData() {
            try {
                const response = await fetch('/api/sample_data');
                const data = await response.json();
                
                if (data.success && data.data.length > 0) {
                    const preview = document.getElementById('sample-preview');
                    const sample = data.data[0];
                    
                    let html = '<div class="space-y-1">';
                    Object.keys(sample).slice(0, 5).forEach(key => {
                        let value = sample[key];
                        if (typeof value === 'number') {
                            if (key.includes('Revenue') || key.includes('Sales') || key.includes('Market_Cap')) {
                                value = '$' + value.toLocaleString();
                            } else if (key.includes('Margin') || key.includes('Growth')) {
                                value = (value * 100).toFixed(2) + '%';
                            }
                        }
                        html += `<div><span class="font-medium">${key}:</span> ${value}</div>`;
                    });
                    html += '</div>';
                    preview.innerHTML = html;
                }
            } catch (error) {
                console.error('Error loading sample data:', error);
            }
        }

        // Get selected fields
        function getSelectedFields() {
            const checkboxes = document.querySelectorAll('#field-selection input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // Get selected years
        function getSelectedYears() {
            const allCheckbox = document.getElementById('year_all');
            if (allCheckbox.checked) {
                return [];
            }
            
            const checkboxes = document.querySelectorAll('#year-selection input[type="checkbox"]:checked:not(#year_all)');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // Generate report
        async function generateReport() {
            const reportType = document.querySelector('input[name="report_type"]:checked').value;
            const fields = getSelectedFields();
            const years = getSelectedYears();
            
            if (fields.length === 0) {
                alert('Please select at least one field to analyze');
                return;
            }
            
            if (reportType === 'chat') {
                const question = document.getElementById('question').value.trim();
                if (!question) {
                    alert('Please enter a question for AI insights');
                    return;
                }
            }
            
            // Show loading
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results-container').innerHTML = '';
            document.getElementById('report-status').textContent = 'Generating report...';
            
            try {
                const payload = {
                    report_type: reportType,
                    fields: fields,
                    years: years
                };
                
                if (reportType === 'chat') {
                    payload.question = document.getElementById('question').value;
                }
                
                const response = await fetch('/api/generate_report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayResults(data.result);
                    document.getElementById('report-status').textContent = 'Report generated successfully';
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error generating report:', error);
                document.getElementById('results-container').innerHTML = `
                    <div class="text-center py-8 text-red-600">
                        <div class="text-4xl mb-2">‚ùå</div>
                        <p class="font-medium">Error generating report</p>
                        <p class="text-sm">${error.message}</p>
                    </div>
                `;
                document.getElementById('report-status').textContent = 'Error generating report';
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // Display results
        function displayResults(result) {
            const container = document.getElementById('results-container');
            
            if (result.type === 'summary') {
                displaySummaryReport(result, container);
            } else if (result.type === 'trend') {
                displayTrendReport(result, container);
            } else if (result.type === 'comparison') {
                displayComparisonReport(result, container);
            } else if (result.type === 'distribution') {
                displayDistributionReport(result, container);
            } else if (result.type === 'chat') {
                displayChatReport(result, container);
            }
        }

        // Display summary report
        function displaySummaryReport(result, container) {
            let html = `
                <div class="space-y-6">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800 mb-2">üìä Summary Statistics</h3>
                        <p class="text-sm text-blue-600">Analysis for ${result.fields.join(', ')} | Years: ${result.years.length > 0 ? result.years.join(', ') : 'All'}</p>
                    </div>
            `;
            
            Object.keys(result.data).forEach(field => {
                const stats = result.data[field];
                html += `
                    <div class="border rounded-lg p-4">
                        <h4 class="font-semibold mb-3">${field}</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                `;
                
                if (stats.min !== undefined) {
                    let minValue = stats.min;
                    if (field.includes('Revenue') || field.includes('Sales') || field.includes('Market_Cap')) {
                        minValue = '$' + minValue.toLocaleString();
                    } else if (field.includes('Margin') || field.includes('Growth')) {
                        minValue = (minValue * 100).toFixed(2) + '%';
                    }
                    html += `<div class="text-center"><div class="text-2xl font-bold text-gray-800">${minValue}</div><div class="text-sm text-gray-600">Minimum</div></div>`;
                }
                
                if (stats.max !== undefined) {
                    let maxValue = stats.max;
                    if (field.includes('Revenue') || field.includes('Sales') || field.includes('Market_Cap')) {
                        maxValue = '$' + maxValue.toLocaleString();
                    } else if (field.includes('Margin') || field.includes('Growth')) {
                        maxValue = (maxValue * 100).toFixed(2) + '%';
                    }
                    html += `<div class="text-center"><div class="text-2xl font-bold text-gray-800">${maxValue}</div><div class="text-sm text-gray-600">Maximum</div></div>`;
                }
                
                if (stats.avg !== undefined) {
                    let avgValue = stats.avg;
                    if (field.includes('Revenue') || field.includes('Sales') || field.includes('Market_Cap')) {
                        avgValue = '$' + avgValue.toLocaleString();
                    } else if (field.includes('Margin') || field.includes('Growth')) {
                        avgValue = (avgValue * 100).toFixed(2) + '%';
                    }
                    html += `<div class="text-center"><div class="text-2xl font-bold text-blue-600">${avgValue}</div><div class="text-sm text-gray-600">Average</div></div>`;
                }
                
                if (stats.count !== undefined) {
                    html += `<div class="text-center"><div class="text-2xl font-bold text-green-600">${stats.count.toLocaleString()}</div><div class="text-sm text-gray-600">Count</div></div>`;
                }
                
                if (stats.sum !== undefined) {
                    let sumValue = '$' + stats.sum.toLocaleString();
                    html += `<div class="text-center"><div class="text-2xl font-bold text-purple-600">${sumValue}</div><div class="text-sm text-gray-600">Total Sum</div></div>`;
                }
                
                html += '</div></div>';
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Display trend report
        function displayTrendReport(result, container) {
            let html = `
                <div class="space-y-6">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-green-800 mb-2">üìà Trend Analysis</h3>
                        <p class="text-sm text-green-600">Year-over-year trends for ${result.fields.join(', ')}</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full border rounded-lg">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Year</th>
            `;
            
            result.fields.forEach(field => {
                if (field !== 'Year') {
                    html += `<th class="px-4 py-2 text-left text-sm font-medium text-gray-700">${field}</th>`;
                }
            });
            
            html += '</tr></thead><tbody>';
            
            result.data.forEach(row => {
                html += '<tr class="border-t">';
                html += `<td class="px-4 py-2 font-medium">${row._id}</td>`;
                
                result.fields.forEach(field => {
                    if (field !== 'Year' && row[field] !== undefined) {
                        let value = row[field];
                        if (field.includes('Revenue') || field.includes('Sales') || field.includes('Market_Cap')) {
                            value = '$' + value.toLocaleString();
                        } else if (field.includes('Margin') || field.includes('Growth')) {
                            value = (value * 100).toFixed(2) + '%';
                        }
                        html += `<td class="px-4 py-2">${value}</td>`;
                    }
                });
                
                html += '</tr>';
            });
            
            html += '</tbody></table></div></div>';
            container.innerHTML = html;
            
            // Create chart
            createTrendChart(result);
        }

        // Display comparison report
        function displayComparisonReport(result, container) {
            let html = `
                <div class="space-y-6">
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-purple-800 mb-2">üèÜ Performance Comparison</h3>
                        <p class="text-sm text-purple-600">Top and Bottom Performers for ${result.fields.join(', ')}</p>
                    </div>
            `;
            
            // Top performers
            html += `
                <div class="border rounded-lg p-4">
                    <h4 class="font-semibold mb-3 text-green-600">ü•á Top 10 Performers</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
            `;
            
            result.fields.forEach(field => {
                html += `<th class="px-2 py-1 text-left font-medium">${field}</th>`;
            });
            
            html += '</tr></thead><tbody>';
            
            result.data.top_performers.forEach(row => {
                html += '<tr class="border-t">';
                result.fields.forEach(field => {
                    let value = row[field];
                    if (typeof value === 'number') {
                        if (field.includes('Revenue') || field.includes('Sales') || field.includes('Market_Cap')) {
                            value = '$' + value.toLocaleString();
                        } else if (field.includes('Margin') || field.includes('Growth')) {
                            value = (value * 100).toFixed(2) + '%';
                        }
                    }
                    html += `<td class="px-2 py-1">${value}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table></div></div>';
            
            // Bottom performers
            html += `
                <div class="border rounded-lg p-4">
                    <h4 class="font-semibold mb-3 text-red-600">üìâ Bottom 10 Performers</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
            `;
            
            result.fields.forEach(field => {
                html += `<th class="px-2 py-1 text-left font-medium">${field}</th>`;
            });
            
            html += '</tr></thead><tbody>';
            
            result.data.bottom_performers.forEach(row => {
                html += '<tr class="border-t">';
                result.fields.forEach(field => {
                    let value = row[field];
                    if (typeof value === 'number') {
                        if (field.includes('Revenue') || field.includes('Sales') || field.includes('Market_Cap')) {
                            value = '$' + value.toLocaleString();
                        } else if (field.includes('Margin') || field.includes('Growth')) {
                            value = (value * 100).toFixed(2) + '%';
                        }
                    }
                    html += `<td class="px-2 py-1">${value}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table></div></div></div>';
            container.innerHTML = html;
        }

        // Display distribution report
        function displayDistributionReport(result, container) {
            let html = `
                <div class="space-y-6">
                    <div class="bg-orange-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-orange-800 mb-2">üìä Distribution Analysis</h3>
                        <p class="text-sm text-orange-600">Data distribution for ${result.fields.join(', ')}</p>
                    </div>
            `;
            
            Object.keys(result.data).forEach(field => {
                const distribution = result.data[field];
                html += `
                    <div class="border rounded-lg p-4">
                        <h4 class="font-semibold mb-3">${field}</h4>
                        <div class="space-y-2">
                `;
                
                distribution.forEach(bucket => {
                    const range = bucket._id === 'Other' ? 'Other' : `${bucket._id}`;
                    const percentage = (bucket.count / 1100000) * 100;
                    html += `
                        <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                            <span class="text-sm font-medium">${range}</span>
                            <div class="flex items-center">
                                <div class="w-32 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: ${Math.min(percentage, 100)}%"></div>
                                </div>
                                <span class="text-sm">${bucket.count.toLocaleString()} (${percentage.toFixed(1)}%)</span>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Display chat report
        function displayChatReport(result, container) {
            let html = `
                <div class="space-y-6">
                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-indigo-800 mb-2">üí¨ AI Insights</h3>
                        <p class="text-sm text-indigo-600">Question: "${result.question}"</p>
                    </div>
                    <div class="space-y-4">
            `;
            
            result.insights.forEach(insight => {
                html += `
                    <div class="flex items-start p-4 bg-white border rounded-lg">
                        <div class="text-2xl mr-3">üí°</div>
                        <p class="text-gray-700">${insight}</p>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    <div class="text-sm text-gray-500 text-center">
                        Analysis based on ${result.sample_count} sample records
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // Create trend chart
        function createTrendChart(result) {
            const chartContainer = document.getElementById('chart-container');
            chartContainer.classList.remove('hidden');
            
            const ctx = document.getElementById('report-chart').getContext('2d');
            
            // Destroy existing chart if any
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Prepare data
            const labels = result.data.map(row => row._id);
            const datasets = [];
            
            const colors = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'];
            
            result.fields.forEach((field, index) => {
                if (field !== 'Year') {
                    datasets.push({
                        label: field,
                        data: result.data.map(row => row[field]),
                        borderColor: colors[index % colors.length],
                        backgroundColor: colors[index % colors.length] + '20',
                        tension: 0.1
                    });
                }
            });
            
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Trend Analysis'
                        },
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
